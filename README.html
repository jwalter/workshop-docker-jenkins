<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>README</title>
      <style>.markdown-preview, .markdown-preview[data-use-github-style] { font-family: 'Helvetica Neue', Helvetica, 'Segoe UI', Arial, freesans, sans-serif; font-size: 16px; line-height: 1.6; word-wrap: break-word; overflow: scroll; box-sizing: border-box; padding: 20px; background-color: rgb(255, 255, 255); }
.markdown-preview > :first-child, .markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview > :last-child, .markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview a:not([href]), .markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview .absent, .markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview .anchor, .markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview .anchor:focus, .markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview h1 .octicon-link, .markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview h2 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview h3 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview h4 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview h5 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview h6 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview h1:hover .anchor, .markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview h2:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview h3:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview h4:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview h5:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview h6:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview h6:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview h1 tt, .markdown-preview[data-use-github-style] h1 tt, .markdown-preview h2 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview h3 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview h4 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview h5 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview h6 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview h1 code, .markdown-preview[data-use-github-style] h1 code, .markdown-preview h2 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview h3 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview h4 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview h5 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview h6 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h1 .anchor, .markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview h2, .markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: rgb(238, 238, 238); }
.markdown-preview h2 .anchor, .markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview h3, .markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview h3 .anchor, .markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview h4, .markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview h4 .anchor, .markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview h5, .markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview h5 .anchor, .markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview h6, .markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview h6 .anchor, .markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview p, .markdown-preview[data-use-github-style] p, .markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote, .markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol, .markdown-preview dl, .markdown-preview[data-use-github-style] dl, .markdown-preview table, .markdown-preview[data-use-github-style] table, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview hr, .markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview ul, .markdown-preview[data-use-github-style] ul, .markdown-preview ol, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview ul.no-list, .markdown-preview[data-use-github-style] ul.no-list, .markdown-preview ol.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview ul ul, .markdown-preview[data-use-github-style] ul ul, .markdown-preview ul ol, .markdown-preview[data-use-github-style] ul ol, .markdown-preview ol ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview ol ul, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview li > p, .markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview dl, .markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview dl dt, .markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview dl dd, .markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview blockquote, .markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left-width: 4px; border-left-style: solid; border-left-color: rgb(221, 221, 221); }
.markdown-preview blockquote > :first-child, .markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview blockquote > :last-child, .markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview table, .markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: normal; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview table th, .markdown-preview[data-use-github-style] table th, .markdown-preview table td, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview table tr, .markdown-preview[data-use-github-style] table tr { border-top-width: 1px; border-top-style: solid; border-top-color: rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview table tr:nth-child(2n), .markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview img, .markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview span.frame, .markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview span.frame > span, .markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview span.frame span img, .markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview span.frame span span, .markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview span.align-center, .markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-center > span, .markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview span.align-center span img, .markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview span.align-right, .markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview span.align-right > span, .markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview span.align-right span img, .markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview span.float-left, .markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview span.float-left span, .markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview span.float-right, .markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview span.float-right > span, .markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview code::before, .markdown-preview[data-use-github-style] code::before, .markdown-preview tt::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview code::after, .markdown-preview[data-use-github-style] code::after, .markdown-preview tt::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: ' '; }
.markdown-preview code br, .markdown-preview[data-use-github-style] code br, .markdown-preview tt br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview del code, .markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview pre > code, .markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview .highlight, .markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre, .markdown-preview pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview .highlight pre, .markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview pre, .markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview pre code, .markdown-preview[data-use-github-style] pre code, .markdown-preview pre tt, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview pre code::before, .markdown-preview[data-use-github-style] pre code::before, .markdown-preview pre tt::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview pre code::after, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview pre tt::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview kbd, .markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-style: solid; border-width: 1px; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview, .markdown-preview[data-use-github-style], .markdown-preview code, .markdown-preview[data-use-github-style] code { color: rgb(51, 51, 51); }
.markdown-preview h1, .markdown-preview[data-use-github-style] h1, .markdown-preview h2, .markdown-preview[data-use-github-style] h2, .markdown-preview h3, .markdown-preview[data-use-github-style] h3, .markdown-preview h4, .markdown-preview[data-use-github-style] h4, .markdown-preview h5, .markdown-preview[data-use-github-style] h5, .markdown-preview h6, .markdown-preview[data-use-github-style] h6 { -webkit-font-smoothing: antialiased; cursor: text; }
.markdown-preview > h1:first-child, .markdown-preview[data-use-github-style] > h1:first-child, .markdown-preview > h1:first-child + h2, .markdown-preview[data-use-github-style] > h1:first-child + h2, .markdown-preview > h2:first-child, .markdown-preview[data-use-github-style] > h2:first-child, .markdown-preview > h3:first-child, .markdown-preview[data-use-github-style] > h3:first-child, .markdown-preview > h4:first-child, .markdown-preview[data-use-github-style] > h4:first-child, .markdown-preview > h5:first-child, .markdown-preview[data-use-github-style] > h5:first-child, .markdown-preview > h6:first-child, .markdown-preview[data-use-github-style] > h6:first-child { margin-top: 0px; padding-top: 0px; }
.markdown-preview a, .markdown-preview[data-use-github-style] a, .markdown-preview a code, .markdown-preview[data-use-github-style] a code { color: rgb(65, 131, 196); }
.markdown-preview a:first-child h1, .markdown-preview[data-use-github-style] a:first-child h1, .markdown-preview a:first-child h2, .markdown-preview[data-use-github-style] a:first-child h2, .markdown-preview a:first-child h3, .markdown-preview[data-use-github-style] a:first-child h3, .markdown-preview a:first-child h4, .markdown-preview[data-use-github-style] a:first-child h4, .markdown-preview a:first-child h5, .markdown-preview[data-use-github-style] a:first-child h5, .markdown-preview a:first-child h6, .markdown-preview[data-use-github-style] a:first-child h6 { margin-top: 0px; padding-top: 0px; }
.markdown-preview h1 + p, .markdown-preview[data-use-github-style] h1 + p, .markdown-preview h2 + p, .markdown-preview[data-use-github-style] h2 + p, .markdown-preview h3 + p, .markdown-preview[data-use-github-style] h3 + p, .markdown-preview h4 + p, .markdown-preview[data-use-github-style] h4 + p, .markdown-preview h5 + p, .markdown-preview[data-use-github-style] h5 + p, .markdown-preview h6 + p, .markdown-preview[data-use-github-style] h6 + p { margin-top: 0px; }
.markdown-preview li p.first, .markdown-preview[data-use-github-style] li p.first { display: inline-block; }
.markdown-preview ul li > :first-child, .markdown-preview[data-use-github-style] ul li > :first-child, .markdown-preview ol li > :first-child, .markdown-preview[data-use-github-style] ol li > :first-child, .markdown-preview ul li ul:first-of-type, .markdown-preview[data-use-github-style] ul li ul:first-of-type, .markdown-preview ol li ul:first-of-type, .markdown-preview[data-use-github-style] ol li ul:first-of-type { margin-top: 0px; }
.markdown-preview ol > li, .markdown-preview[data-use-github-style] ol > li { list-style-type: decimal; }
.markdown-preview ul > li, .markdown-preview[data-use-github-style] ul > li { list-style-type: disc; }
.markdown-preview dl dt:first-child, .markdown-preview[data-use-github-style] dl dt:first-child { padding: 0px; }
.markdown-preview dl dt > :first-child, .markdown-preview[data-use-github-style] dl dt > :first-child { margin-top: 0px; }
.markdown-preview dl dt > :last-child, .markdown-preview[data-use-github-style] dl dt > :last-child { margin-bottom: 0px; }
.markdown-preview dl dd > :first-child, .markdown-preview[data-use-github-style] dl dd > :first-child { margin-top: 0px; }
.markdown-preview dl dd > :last-child, .markdown-preview[data-use-github-style] dl dd > :last-child { margin-bottom: 0px; }
.markdown-preview blockquote p, .markdown-preview[data-use-github-style] blockquote p { font-size: 16px; line-height: 1.5; }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { padding: 16px; overflow: auto; font-size: 84%; line-height: 1.45; border-radius: 3px; background-color: rgb(255, 255, 255); }
.markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { margin-bottom: 16px; word-break: normal; }
.markdown-preview code, .markdown-preview[data-use-github-style] code, .markdown-preview tt, .markdown-preview[data-use-github-style] tt, .markdown-preview pre.editor-colors, .markdown-preview[data-use-github-style] pre.editor-colors { font-family: Consolas, 'Liberation Mono', Courier, monospace; }
.markdown-preview .emoji, .markdown-preview[data-use-github-style] .emoji { height: 20px; width: 20px; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

pre.editor-colors,
.host {
  background-color: #ffffff;
  color: #555555;
}
pre.editor-colors .invisible-character,
.host .invisible-character {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .indent-guide,
.host .indent-guide {
  color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .wrap-guide,
.host .wrap-guide {
  background-color: rgba(85, 85, 85, 0.2);
}
pre.editor-colors .gutter,
.host .gutter {
  color: #555555;
  background: #ffffff;
}
pre.editor-colors .gutter .line-number.folded,
.host .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
.host .gutter .line-number:after,
pre.editor-colors .fold-marker:after,
.host .fold-marker:after {
  color: #e87b00;
}
pre.editor-colors .invisible,
.host .invisible {
  color: #555;
}
pre.editor-colors .selection .region,
.host .selection .region {
  background-color: #e1e1e1;
}
pre.editor-colors.is-focused .cursor,
.host.is-focused .cursor {
  border-color: #000000;
}
pre.editor-colors.is-focused .selection .region,
.host.is-focused .selection .region {
  background-color: #afc4da;
}
pre.editor-colors.is-focused .line-number.cursor-line-no-selection,
.host.is-focused .line-number.cursor-line-no-selection,
pre.editor-colors.is-focused .line.cursor-line,
.host.is-focused .line.cursor-line {
  background-color: rgba(255, 255, 134, 0.34);
}
pre.editor-colors .source.gfm,
.host .source.gfm {
  color: #444;
}
pre.editor-colors .gfm .markup.heading,
.host .gfm .markup.heading {
  color: #111;
}
pre.editor-colors .gfm .link,
.host .gfm .link {
  color: #888;
}
pre.editor-colors .gfm .variable.list,
.host .gfm .variable.list {
  color: #888;
}
pre.editor-colors .markdown .paragraph,
.host .markdown .paragraph {
  color: #444;
}
pre.editor-colors .markdown .heading,
.host .markdown .heading {
  color: #111;
}
pre.editor-colors .markdown .link,
.host .markdown .link {
  color: #888;
}
pre.editor-colors .markdown .link .string,
.host .markdown .link .string {
  color: #888;
}
.host(.is-focused) .cursor {
  border-color: #000000;
}
.host(.is-focused) .selection .region {
  background-color: #afc4da;
}
.host(.is-focused) .line-number.cursor-line-no-selection,
.host(.is-focused) .line.cursor-line {
  background-color: rgba(255, 255, 134, 0.34);
}
.comment {
  color: #999988;
  font-style: italic;
}
.string {
  color: #D14;
}
.string .source,
.string .meta.embedded.line {
  color: #5A5A5A;
}
.string .punctuation.section.embedded {
  color: #920B2D;
}
.string .punctuation.section.embedded .source {
  color: #920B2D;
}
.constant.numeric {
  color: #D14;
}
.constant.language {
  color: #606aa1;
}
.constant.character,
.constant.other {
  color: #606aa1;
}
.constant.symbol {
  color: #990073;
}
.constant.numeric.line-number.find-in-files .match {
  color: rgba(143, 190, 0, 0.63);
}
.variable {
  color: #008080;
}
.variable.parameter {
  color: #606aa1;
}
.keyword {
  color: #222;
  font-weight: bold;
}
.keyword.unit {
  color: #445588;
}
.keyword.special-method {
  color: #0086B3;
}
.storage {
  color: #222;
}
.storage.type {
  color: #222;
}
.entity.name.class {
  text-decoration: underline;
  color: #606aa1;
}
.entity.other.inherited-class {
  text-decoration: underline;
  color: #606aa1;
}
.entity.name.function {
  color: #900;
}
.entity.name.tag {
  color: #008080;
}
.entity.other.attribute-name {
  color: #458;
  font-weight: bold;
}
.entity.name.filename.find-in-files {
  color: #E6DB74;
}
.support.constant,
.support.function,
.support.type {
  color: #458;
}
.support.class {
  color: #008080;
}
.invalid {
  color: #F8F8F0;
  background-color: #00A8C6;
}
.invalid.deprecated {
  color: #F8F8F0;
  background-color: #8FBE00;
}
.meta.structure.dictionary.json > .string.quoted.double.json,
.meta.structure.dictionary.json > .string.quoted.double.json .punctuation.string {
  color: #000080;
}
.meta.structure.dictionary.value.json > .string.quoted.double.json {
  color: #d14;
}
.meta.diff,
.meta.diff.header {
  color: #75715E;
}
.css.support.property-name {
  font-weight: bold;
  color: #333;
}
.css.constant {
  color: #099;
}
.bracket-matcher .region {
  background-color: #C9C9C9;
  opacity: .7;
  border-bottom: 0 none;
}
</style>
  </head>
  <body class='markdown-preview'><h1 id="workshop-docker-jenkins-startpoint">workshop-docker-jenkins-startpoint</h1>
<p>Startpoint for participants in the workshop</p>
<h2 id="prerequisites-">Prerequisites:</h2>
<ul>
<li>VirtualBox: <a href="https://www.virtualbox.org/wiki/Downloads">https://www.virtualbox.org/wiki/Downloads</a></li>
<li>Vagrant: <a href="http://www.vagrantup.com/downloads.html">https://www.virtualbox.org/wiki/Downloads</a></li>
</ul>
<h3 id="on-windows-machines-">On Windows machines**:</h3>
<ul>
<li>Git bash: <a href="https://msysgit.github.io/">https://msysgit.github.io/</a> or other package providing ssh. Ensure that the path containing the ssh.exe file is in your system PATH (ie.: <code>set PATH=%PATH%;C:\Program Files (x86)\Git\bin</code>)</li>
</ul>
<h2 id="getting-started">Getting Started</h2>
<ul>
<li>Copy contents of the usb drive to your local disk</li>
<li>Open a (unix/bash) shell and go to the &#39;workshop-docker-jenkins&#39; directory</li>
<li>Type &#39;vagrant up&#39;</li>
<li>Wait...</li>
<li>Type &#39;vagrant ssh&#39;</li>
</ul>
<p>You should now be logged into the virtual machine.</p>
<h3 id="basic-docker-commands">Basic Docker commands</h3>
<p>Within the virtual machine, docker should be running. Let&#39;s try:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>$</span><span class="keyword operator redirect shell"><span>&gt;</span></span><span>&nbsp;docker&nbsp;ps</span></span></div></pre>
<p>You should get a response that looks like this:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>vagrant@vagrant-ubuntu-vivid-64:</span><span class="keyword operator tilde shell"><span>~</span></span><span>$&nbsp;docker&nbsp;ps</span></span></div><div class="line"><span class="source shell"><span>CONTAINER&nbsp;ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES</span></span></div></pre>
<p><strong>Note</strong>: if you get a response that looks like this:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>FATA[0000]&nbsp;Get&nbsp;http:///var/run/docker.sock/v1.18/containers/json:&nbsp;dial&nbsp;unix&nbsp;/var/run/docker.sock:&nbsp;no&nbsp;such&nbsp;file&nbsp;or&nbsp;directory.&nbsp;Are&nbsp;you&nbsp;trying&nbsp;to&nbsp;connect&nbsp;to&nbsp;a&nbsp;TLS-enabled&nbsp;daemon&nbsp;without&nbsp;TLS</span><span class="keyword operator glob shell"><span>?</span></span></span></div></pre>
<p>simply restart the docker daemon in the vm by typing:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>sudo&nbsp;service&nbsp;docker&nbsp;restart</span></span></div></pre>
<h3 id="starting-containers">Starting containers</h3>
<p>Let&#39;s start a container. To start jenkins within the vm, type:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>docker&nbsp;run&nbsp;-d&nbsp;-v&nbsp;/home/vagrant/.m2:/root/.m2&nbsp;-v&nbsp;/var/run/docker.sock:/var/run/docker.sock&nbsp;-p&nbsp;8080:8080&nbsp;--name&nbsp;jenkins&nbsp;wouterla/docker-jenkins</span></span></div></pre>
<p>See <a href="https://docs.docker.com/reference/commandline/cli/">https://docs.docker.com/reference/commandline/cli/</a> for the documentation of the docker run command. What we are using here is:</p>
<ul>
<li><strong>-d</strong> - run this container in the background</li>
<li><strong>-v host-dir:container-dir</strong> - mount a file or directory from the host (our vm) to the docker container. We mount the pre-filled maven repository, to avoid having to download the internet, and we mount the docker socket so jenkins will be able to start other containers.</li>
<li><strong>-p host-port:container-port</strong> - expose a port from the container to the outside</li>
<li><strong>--name a-name</strong> - a name we can use to refer to this container</li>
<li><strong>repository/name:tag</strong> - the name/location of the docker image</li>
</ul>
<p>Now that we&#39;ve started jenkins, we can check that it is running by typing:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>docker&nbsp;ps</span></span></div></pre>
<p>again, this time we should get something like:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>vagrant@vagrant-ubuntu-vivid-64:</span><span class="keyword operator tilde shell"><span>~</span></span><span>$&nbsp;docker&nbsp;ps</span></span></div><div class="line"><span class="source shell"><span>CONTAINER&nbsp;ID&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;IMAGE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;COMMAND&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CREATED&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;STATUS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PORTS&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;NAMES</span></span></div><div class="line"><span class="source shell"><span>27c0e62bfbaa&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;wouterla/docker-jenkins:latest&nbsp;&nbsp;&nbsp;</span><span class="string quoted double shell"><span class="punctuation definition string begin shell"><span>&quot;</span></span><span>/bin/sh&nbsp;-c&nbsp;&#39;java&nbsp;-j&nbsp;&nbsp;&nbsp;23&nbsp;seconds&nbsp;ago&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Up&nbsp;22&nbsp;seconds&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0.0.0.0:8080-&gt;8080/tcp&nbsp;&nbsp;&nbsp;jenkins</span></span></span></div></pre>
<p>Now you can access jenkins by opening <a href="http://localhost:9080">http://localhost:9080</a>. We are not accessing the docker image, or port, directly. There is yet another level of port forwarding used to link the vagrant vm to your local network. Check the Vagrantfile to see how that&#39;s done. We are forwarding port 8080 on the vagrant machine to port 9080 on your local machine. And 8081-&gt;9081, 8082-&gt;9082, 8083-&gt;9083.</p>
<p>But this jenkins is still empty. No job have been defined yet. We will not be adding any jobs or configuration to jenkins by hand. To see how jobs are defined, have a look at the definitions in <a href="roles/jenkins-jobs/jobs/jobs.yml">roles/jenkins-jobs/jobs/jobs.yml</a>.</p>
<p>Those jobs are packaged in a separate docker image, together with the means to add them tdocker run --link jenkins:jenkins wouterla/docker-jenkins-job-builder o jenkins: <a href="jenkins-job-builder">http://docs.openstack.org/infra/jenkins-job-builder/</a>. A few jobs are pre-packaged, and you can add them to jenkins by running:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>docker&nbsp;run&nbsp;--link&nbsp;jenkins:jenkins&nbsp;wouterla/docker-jenkins-job-builder</span></span></div></pre>
<p>You can see that we have a new switch to the docker &#39;run&#39; command, here:</p>
<ul>
<li><strong>--link container-name:alias</strong> - we link an existing, running, container to the new one, and give it a name. For our current purposes, this means that the jenkins container&#39;s ip address will be added to the &#39;hosts&#39; file of the new container with the hostname &#39;jenkins&#39;.</li>
</ul>
<p>When this container is run, you see the output of the main process (<code>jenkins-jobs</code>) on the command-line. This process runs it course and then returns, stopping the container.</p>
<p>Now, you can see three pre-defined jobs in jenkins, &#39;petclinic-start&#39;, &#39;petclinic-test&#39; and &#39;done&#39;. Start &#39;petclinic-start&#39;, and switch to the &#39;pipelines&#39; view to see the basic pipeline working.</p>
<h3 id="adding-jobs">Adding jobs</h3>
<p>To add a job to our build pipelins, we need a new job-template, and to call that template from our project<img class="emoji" title=":x:" alt="x" src="/opt/atom/resources/app.asar/node_modules/roaster/node_modules/emoji-images/pngs/x.png" height="20"></p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>job-template</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-package</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>maven-target</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{goals}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<p>Note that we don&#39;t have to do anything to configure the git repository, since that is all coming from the defaults.</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-package&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>install</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>done</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<p>Don&#39;t forget to also update the <code>next-job</code> from the test job to point to this new &#39;petclinic-package&#39; job!</p>
<h3 id="building-containers">Building containers</h3>
<p>To build a new version of the jenkins-job-builder container, we need to use the docker build command. The script <a href="build_docker_jenkins_job_builder.sh">build_docker_jenkins_job_builder.sh</a> shows all the steps, but the only one specific to building the container is:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>docker&nbsp;build&nbsp;-t&nbsp;wouterla/docker-jenkins-job-builder&nbsp;</span><span class="support function builtin shell"><span>.</span></span></span></div></pre>
<p>Again, we see the format of the &#39;tag&#39;, comprising of the repository (wouterla), the name (docker-jenkins-job-builder) and the tag (not given, so defaulting to &#39;latest&#39;). This form of the command assumes all related files are in the current directory (the &#39;.&#39; at the end). See the full documentation <a href="on the docker site">https://docs.docker.com/reference/commandline/cli/#build</a>.</p>
<p>In the context of this workshop, simply run the script.</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>./build_docker_jenkins_job_builder.sh</span></span></div></pre>
<p>Then, re-run the job-builder container to add the new job to jenkins:</p>
<pre class="editor-colors lang-shell"><div class="line"><span class="source shell"><span>docker&nbsp;run&nbsp;--link&nbsp;jenkins:jenkins&nbsp;wouterla/docker-jenkins-job-builder</span></span></div></pre>
<h3 id="creating-a-dockerfile">Creating a Dockerfile</h3>
<p>To be able to deploy the demo app, we need to complete the Dockerfile. The Dockerfile in your <a href="spring-petclinic/docker">spring-petclinic/docker</a> directory is incomplete. It specifies the base image (docker-base) that contains usefull things, like a java runtime. To make it install the jetty-runner app, and run our petclinit example application from the war generated by the maven install goal, change it to:</p>
<pre class="editor-colors lang-docker"><div class="line"><span class="text plain null-grammar"><span>FROM&nbsp;wouterla/docker-base</span></span></div><div class="line"><span class="text plain null-grammar"><span>MAINTAINER&nbsp;Wouter&nbsp;Lagerweij&nbsp;&lt;wouter@lagerweij.com&gt;</span></span></div><div class="line"><span class="text plain null-grammar"><span>&nbsp;</span></span></div><div class="line"><span class="text plain null-grammar"><span>#&nbsp;Normally&nbsp;we&#39;d&nbsp;retrieve&nbsp;the&nbsp;jetty-runner&nbsp;jar&nbsp;directly&nbsp;from&nbsp;the&nbsp;internet,</span></span></div><div class="line"><span class="text plain null-grammar"><span>#&nbsp;but&nbsp;we&nbsp;want&nbsp;to&nbsp;make&nbsp;sure&nbsp;we&nbsp;don&#39;t&nbsp;overtax&nbsp;conference&nbsp;wifi,&nbsp;so&nbsp;it&#39;s&nbsp;included</span></span></div><div class="line"><span class="text plain null-grammar"><span>#&nbsp;in&nbsp;the&nbsp;image</span></span></div><div class="line"><span class="text plain null-grammar"><span>#&nbsp;RUN&nbsp;curl&nbsp;-L&nbsp;</span><span class="markup underline link http hyperlink"><span>http://repo2.maven.org/maven2/org/mortbay/jetty/jetty-runner/8.1.9.v20130131/jetty-runner-8.1.9.v20130131.jar</span></span><span>&nbsp;-o&nbsp;jetty-runner.jar</span></span></div><div class="line"><span class="text plain null-grammar"><span>&nbsp;</span></span></div><div class="line"><span class="text plain null-grammar"><span>RUN&nbsp;mkdir&nbsp;-p&nbsp;/opt/jetty</span></span></div><div class="line"><span class="text plain null-grammar"><span>WORKDIR&nbsp;/opt/jetty</span></span></div><div class="line"><span class="text plain null-grammar"><span>ADD&nbsp;jetty-runner.jar&nbsp;./</span></span></div><div class="line"><span class="text plain null-grammar"><span>&nbsp;</span></span></div><div class="line"><span class="text plain null-grammar"><span>ADD&nbsp;petclinic.war&nbsp;./</span></span></div><div class="line"><span class="text plain null-grammar"><span>&nbsp;</span></span></div><div class="line"><span class="text plain null-grammar"><span>CMD&nbsp;java&nbsp;-jar&nbsp;jetty-runner.jar&nbsp;petclinic.war</span></span></div></pre>
<h3 id="add-the-building-of-the-docker-image-to-the-jenkins-pipeline">Add the building of the docker image to the jenkins pipeline</h3>
<p>For this we need to have the contents of the build_docker_petclinic.sh script within the jenkins-job-builder yaml. In other circumstances we could also call the existing script, or even add the building of the docker image to maven using <a href="the maven docker plugin">https://github.com/spotify/docker-maven-plugin</a>, but for the purposes of understanding what&#39;s going on in this process, we&#39;ll make it explicit:</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>job-template</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-create-docker-image</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>maven-target</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>clean&nbsp;install</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span class="string unquoted block yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>shell</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;|</span></span></span></div><div class="line"><span class="source yaml"><span class="punctuation whitespace comment leading yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>!/bin/bash</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>v</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>e</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span class="string quoted double yaml"><span class="punctuation definition string begin yaml"><span>&quot;</span></span><span>Copying&nbsp;docker&nbsp;files</span><span class="punctuation definition string end yaml"><span>&quot;</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cp&nbsp;docker/*&nbsp;target/</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span class="string quoted double yaml"><span class="punctuation definition string begin yaml"><span>&quot;</span></span><span>Running&nbsp;docker</span><span class="punctuation definition string end yaml"><span>&quot;</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cd&nbsp;target/</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker&nbsp;build&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>t&nbsp;wouterla/docker-petclinic&nbsp;.</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;</span></span></div><div class="line"><span class="source yaml"><span class="punctuation whitespace comment leading yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>echo&nbsp;&quot;Pushing&nbsp;docker&nbsp;image&nbsp;to&nbsp;repository&quot;</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source yaml"><span class="punctuation whitespace comment leading yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>docker&nbsp;push&nbsp;wouterla/docker-jenkins</span><span>&nbsp;</span></span></span></div></pre>
<p>Note the use of the pipe (&#39;|&#39;) symbol to include multiple lines of pre-formatted code. A default yaml feature.</p>
<p>Note that we&#39;re not pushing the image to the repository. You&#39;d need to login, and have a fast internet connection to do so. Adding this job-template to our project is similar to our previous change. The project will now look somewhat like this:</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="entity name tag yaml"><span>jobs</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-start&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-package</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-package&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>install</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-create-docker-image</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-create-docker-image&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>done</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<h3 id="deploy-the-container-from-our-pipeline">Deploy the container from our pipeline</h3>
<p>Now that we&#39;ve built our container for the petclinic, it&#39;s time to deploy it on a &#39;test environment&#39;!</p>
<p>We can deploy the container using the docker run command in another shell builder. Since I&#39;d like to be able to deploy to a &#39;production environment&#39; as well, we do a little parametrisation, and use a macro for the builder:</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>builder</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string unquoted yaml"><span>deploy</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span class="string unquoted block yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>shell</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;|</span></span></span></div><div class="line"><span class="source yaml"><span class="punctuation whitespace comment leading yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>!/bin/bash</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>v</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;+e&nbsp;</span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>the&nbsp;next&nbsp;step&nbsp;can&nbsp;return&nbsp;error&nbsp;code&nbsp;if&nbsp;no&nbsp;container&nbsp;is&nbsp;running</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;docker&nbsp;kill&nbsp;{name}</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>{env}&nbsp;&amp;&amp;&nbsp;docker&nbsp;rm&nbsp;{name}-{env}</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>e</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta tag yaml"><span class="entity name tag yaml"><span>docker&nbsp;run&nbsp;-d&nbsp;-p&nbsp;{external-port}</span></span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>{internal</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>port}&nbsp;--name&nbsp;{name}-{env}&nbsp;wouterla/docker-{name}</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;</span></span></div><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>job-template</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-deploy-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>deploy</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{env}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{external-port}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>internal-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{internal-port}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<p>Using different ports allows us to deploy multiple copies of the same container on one docker node. In real life, we&#39;d probable be more comfortable using different nodes for production and test, and perhaps set a &#39;DOCKER_HOST&#39; variable for each environment, or use ansible&#39;s docker module to start the containers on different hosts.</p>
<p><strong>Note</strong>: We have to pass-through the parameters explicitly, even though they have the same name in the project, template and macro. This is a feature (?) of jenkins job builder that I&#39;ve not been able to work around.</p>
<p>The project should not contain something like:</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>project</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string unquoted yaml"><span>petclinic</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>gitrepo</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>spring-petclinic</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>branch</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>master</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>internal-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8080</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>jobs</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-create-docker-image&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-deploy-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-deploy-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8081</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>done</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<p>Since the internal port is always the same, we can define that one on a project level.</p>
<p>Also, not that we now have set the <code>pipeline-stage</code> to <code>test</code>, since we&#39;re actually deploying to a test environment.</p>
<h3 id="a-test-">A test?</h3>
<p>Since this is a demo, we don&#39;t have to run any real integration tests here. On the other hand, before we deploy to &#39;production&#39;, it would be nice to know that our container actually started successfully. So let&#39;s put in a very simple test:</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>builder</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string unquoted yaml"><span>integration-test</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span class="string unquoted block yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>shell</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;|</span></span></span></div><div class="line"><span class="source yaml"><span class="punctuation whitespace comment leading yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></span><span class="comment line number-sign yaml"><span class="punctuation definition comment yaml"><span>#</span></span><span>!/bin/bash</span><span>&nbsp;</span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>v</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;set&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>e</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="meta tag yaml"><span class="entity name tag yaml"><span>URL=http</span></span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>//{</span><span class="meta tag yaml"><span class="entity name tag yaml"><span>host}</span></span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>{external</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>port}/vets.html</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sleep&nbsp;10</span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;curl&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-</span></span><span class="string unquoted yaml"><span>-retry&nbsp;10&nbsp;--retry-max-time&nbsp;10&nbsp;--retry-delay&nbsp;1&nbsp;--output&nbsp;/dev/null&nbsp;--silent&nbsp;--head&nbsp;--fail&nbsp;${{URL}}</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;</span></span></div><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>job-template</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-test-integration-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>integration-test</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>host</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{host}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{external-port}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<h3 id="production">Production</h3>
<p>Now we can add a production stage. We can easily copy the -test job-templates, and fill in the environment and ports for production. We could probably do this with a little less duplication by employing the job-group concept from job builder, but within the confines of the workshop, we&#39;ll stick to copy-past.</p>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>job-template</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-deploy-production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>builders</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>deploy</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{env}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{external-port}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>internal-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{internal-port}</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<pre class="editor-colors lang-yaml"><div class="line"><span class="source yaml"><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>project</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>name</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string unquoted yaml"><span>petclinic</span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>gitrepo</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>spring-petclinic</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>branch</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>master</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>internal-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8080</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>host</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>10.0.2.15</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>jobs</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-start&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>goals</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>install</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-create-docker-image</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-create-docker-image&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>build</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-deploy-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-deploy-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8081</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-test-integration-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-test-integration-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8081</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>{name}-deploy-production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-deploy-production&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8082</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>petclinic-production-integration-test</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="punctuation definition entry yaml"><span>-&nbsp;</span></span><span class="entity name tag yaml"><span>&#39;{name}-production-integration-test&#39;</span><span class="punctuation separator key-value yaml"><span>:</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>pipeline-stage</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>external-port</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>8082</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>env</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>production</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div><div class="line"><span class="source yaml"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="string unquoted yaml"><span class="entity name tag yaml"><span>next-job</span><span class="punctuation separator key-value yaml"><span>:</span></span></span><span>&nbsp;</span><span class="string quoted single yaml"><span class="punctuation definition string begin yaml"><span>&#39;</span></span><span>done</span><span class="punctuation definition string end yaml"><span>&#39;</span></span></span></span></span></div></pre>
<h3 id="another-service-">Another service?</h3>
<p>A good exercise would be to add another service to this system. Since most java services would use the same build scripts, and only different names for the docker image (and different git repository and ports), in many cases it would be enough to simply add a new project, and re-use all the existing job-templates.</p>
<p>For the workshop context, you could try to deploy a different branch of the petclinic code.</p></body>
</html>
